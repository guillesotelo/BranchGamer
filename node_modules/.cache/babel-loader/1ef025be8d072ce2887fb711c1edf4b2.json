{"ast":null,"code":"import { createReducer, createAsyncThunk, createAction } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { addOneToQuantity, removeOneFromQuantity } from \"../utils\";\nimport mergeCarritos from \"../utils/mergeCarritos\";\nexport const getItems = createAsyncThunk(\"GET_ITEMS\", async (data, thunkAPI) => {\n  try {\n    const {\n      isLogIn\n    } = thunkAPI.getState();\n    const localCarrito = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n\n    if (isLogIn) {\n      const {\n        token,\n        id\n      } = data;\n      const req = await axios.get(`/api/cart/items/${id}`, {\n        headers: {\n          authorization: token\n        }\n      });\n      if (localCarrito.length) return mergeCarritos(req.data, localCarrito, token, id);\n      return req.data;\n    } else {\n      const items = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n      return items;\n    }\n  } catch (err) {\n    throw err;\n  }\n});\nexport const addItem = createAsyncThunk(\"ADD_ITEM\", async (data, thunkAPI) => {\n  try {\n    const {\n      token,\n      cartInUse,\n      isLogIn\n    } = thunkAPI.getState();\n\n    if (isLogIn) {\n      const body = {\n        carritoId: cartInUse.id,\n        productId: data.id\n      };\n      const req = await axios.post(\"/api/cart/add\", body, {\n        headers: {\n          authorization: token\n        }\n      });\n      const {\n        productId,\n        quantity\n      } = req.data;\n      return {\n        productId,\n        quantity\n      };\n    } else {\n      const items = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n      const obj = {\n        productId: data.id,\n        quantity: 1\n      };\n      const newItems = [...items, obj];\n      window.localStorage.setItem(\"cart-items-no-log\", JSON.stringify(newItems));\n      return obj;\n    }\n  } catch (err) {\n    throw err;\n  }\n});\nexport const removeItem = createAsyncThunk(\"REMOVE_ITEM\", async (data, thunkAPI) => {\n  try {\n    const {\n      token,\n      cartInUse,\n      isLogIn\n    } = thunkAPI.getState();\n\n    if (isLogIn) {\n      await axios.delete(`/api/cart/${cartInUse.id}/${data.id}`, {\n        headers: {\n          authorization: token\n        }\n      });\n    } else {\n      const items = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n      const newItems = items.filter(item => item.productId !== data.id);\n      window.localStorage.setItem(\"cart-items-no-log\", JSON.stringify(newItems));\n    }\n\n    return data;\n  } catch (err) {\n    throw err;\n  }\n});\nexport const quantityRemove = createAsyncThunk(\"QUANTITY_REMOVE_ITEM\", async (data, thunkAPI) => {\n  try {\n    const {\n      token,\n      cartInUse,\n      isLogIn\n    } = thunkAPI.getState();\n\n    if (isLogIn) {\n      const body = {\n        carritoId: cartInUse.id,\n        productId: data.id,\n        type: \"remove\"\n      };\n      await axios.put(`/api/cart`, body, {\n        headers: {\n          authorization: token\n        }\n      });\n      const req = await axios.get(`/api/cart/items/${cartInUse.id}`, {\n        headers: {\n          authorization: token\n        }\n      });\n      return req.data;\n    } else {\n      const items = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\"));\n      const newItems = removeOneFromQuantity(items, data.id);\n      window.localStorage.setItem(\"cart-items-no-log\", JSON.stringify(newItems));\n      return newItems;\n    }\n  } catch (err) {\n    throw err;\n  }\n});\nexport const quantityAdd = createAsyncThunk(\"QUANTITY_ADD_ITEM\", async (data, thunkAPI) => {\n  try {\n    const {\n      token,\n      cartInUse,\n      isLogIn\n    } = thunkAPI.getState();\n\n    if (isLogIn) {\n      const body = {\n        carritoId: cartInUse.id,\n        productId: data.id,\n        type: \"add\"\n      };\n      await axios.put(`/api/cart`, body, {\n        headers: {\n          authorization: token\n        }\n      });\n      const req = await axios.get(`/api/cart/items/${cartInUse.id}`, {\n        headers: {\n          authorization: token\n        }\n      });\n      return req.data;\n    } else {\n      const items = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\"));\n      const newItems = addOneToQuantity(items, data.id);\n      window.localStorage.setItem(\"cart-items-no-log\", JSON.stringify(newItems));\n      return newItems;\n    }\n  } catch (err) {\n    throw err;\n  }\n});\nexport const setCarritoItemsVacio = createAction(\"set_CarritoItemsVacio\");\nconst cartReducer = createReducer([], {\n  [setCarritoItemsVacio]: (state, action) => [],\n  [getItems.fulfilled]: (state, action) => action.payload,\n  [addItem.fulfilled]: (state, action) => [...state, action.payload],\n  [removeItem.fulfilled]: (state, action) => state.filter(item => item.productId !== action.payload.id),\n  [quantityAdd.fulfilled]: (state, action) => action.payload,\n  [quantityRemove.fulfilled]: (state, action) => action.payload\n});\nexport default cartReducer;","map":{"version":3,"sources":["/Users/guillermosotelo/Documents/P5/BC/branch-and-gamer/src/store/cartReducer.js"],"names":["createReducer","createAsyncThunk","createAction","axios","addOneToQuantity","removeOneFromQuantity","mergeCarritos","getItems","data","thunkAPI","isLogIn","getState","localCarrito","JSON","parse","window","localStorage","getItem","token","id","req","get","headers","authorization","length","items","err","addItem","cartInUse","body","carritoId","productId","post","quantity","obj","newItems","setItem","stringify","removeItem","delete","filter","item","quantityRemove","type","put","quantityAdd","setCarritoItemsVacio","cartReducer","state","action","fulfilled","payload"],"mappings":"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","sourcesContent":["import {\n  createReducer,\n  createAsyncThunk,\n  createAction,\n} from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { addOneToQuantity, removeOneFromQuantity } from \"../utils\";\nimport mergeCarritos from \"../utils/mergeCarritos\";\n\nexport const getItems = createAsyncThunk(\n  \"GET_ITEMS\",\n  async (data, thunkAPI) => {\n    try {\n      const { isLogIn } = thunkAPI.getState();\n      const localCarrito = JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n\n      if (isLogIn) {\n        const { token, id } = data;\n\n        const req = await axios.get(`/api/cart/items/${id}`, {\n          headers: { authorization: token },\n        });\n\n        if(localCarrito.length) return mergeCarritos(req.data, localCarrito, token, id)\n        \n        return req.data;\n\n      } else {\n        const items =\n          JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n\n        return items;\n      }\n    } catch (err) {\n      throw err;\n    }\n  }\n);\n\nexport const addItem = createAsyncThunk(\"ADD_ITEM\", async (data, thunkAPI) => {\n  try {\n    const { token, cartInUse, isLogIn } = thunkAPI.getState();\n\n    if (isLogIn) {\n      const body = {\n        carritoId: cartInUse.id,\n        productId: data.id,\n      };\n\n      const req = await axios.post(\"/api/cart/add\", body, {\n        headers: { authorization: token },\n      });\n\n      const { productId, quantity } = req.data;\n      return { productId, quantity };\n    } else {\n      const items =\n        JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n\n      const obj = { productId: data.id, quantity: 1 };\n\n      const newItems = [...items, obj];\n\n      window.localStorage.setItem(\n        \"cart-items-no-log\",\n        JSON.stringify(newItems)\n      );\n      return obj;\n    }\n  } catch (err) {\n    throw err;\n  }\n});\n\nexport const removeItem = createAsyncThunk(\n  \"REMOVE_ITEM\",\n  async (data, thunkAPI) => {\n    try {\n      const { token, cartInUse, isLogIn } = thunkAPI.getState();\n\n      if (isLogIn) {\n        await axios.delete(`/api/cart/${cartInUse.id}/${data.id}`, {\n          headers: { authorization: token },\n        });\n      } else {\n        const items =\n          JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) || [];\n\n        const newItems = items.filter((item) => item.productId !== data.id);\n\n        window.localStorage.setItem(\n          \"cart-items-no-log\",\n          JSON.stringify(newItems)\n        );\n      }\n      return data;\n    } catch (err) {\n      throw err;\n    }\n  }\n);\n\nexport const quantityRemove = createAsyncThunk(\n  \"QUANTITY_REMOVE_ITEM\",\n  async (data, thunkAPI) => {\n    try {\n      const { token, cartInUse, isLogIn } = thunkAPI.getState();\n      if (isLogIn) {\n        const body = {\n          carritoId: cartInUse.id,\n          productId: data.id,\n          type: \"remove\",\n        };\n\n        await axios.put(`/api/cart`, body, {\n          headers: { authorization: token },\n        });\n\n        const req = await axios.get(`/api/cart/items/${cartInUse.id}`, {\n          headers: { authorization: token },\n        });\n\n        return req.data;\n      } else {\n        const items =\n          JSON.parse(window.localStorage.getItem(\"cart-items-no-log\")) \n\n        const newItems = removeOneFromQuantity(items, data.id);\n\n        window.localStorage.setItem(\n          \"cart-items-no-log\",\n          JSON.stringify(newItems)\n        );\n        return newItems;\n      }\n    } catch (err) {\n      throw err;\n    }\n  }\n);\n\nexport const quantityAdd = createAsyncThunk(\n  \"QUANTITY_ADD_ITEM\",\n  async (data, thunkAPI) => {\n    try {\n      const { token, cartInUse, isLogIn } = thunkAPI.getState();\n      if (isLogIn) {\n        const body = {\n          carritoId: cartInUse.id,\n          productId: data.id,\n          type: \"add\",\n        };\n\n        await axios.put(`/api/cart`, body, {\n          headers: { authorization: token },\n        });\n\n        const req = await axios.get(`/api/cart/items/${cartInUse.id}`, {\n          headers: { authorization: token },\n        });\n\n        return req.data;\n      } else {\n        const items = JSON.parse(\n          window.localStorage.getItem(\"cart-items-no-log\")\n        );\n\n        const newItems = addOneToQuantity(items, data.id);\n\n        window.localStorage.setItem(\n          \"cart-items-no-log\",\n          JSON.stringify(newItems)\n        );\n        return newItems;\n      }\n    } catch (err) {\n      throw err;\n    }\n  }\n);\n\nexport const setCarritoItemsVacio = createAction(\"set_CarritoItemsVacio\");\n\nconst cartReducer = createReducer([], {\n  [setCarritoItemsVacio]: (state, action) => [],\n  [getItems.fulfilled]: (state, action) => action.payload,\n  [addItem.fulfilled]: (state, action) => [...state, action.payload],\n  [removeItem.fulfilled]: (state, action) =>\n    state.filter((item) => item.productId !== action.payload.id),\n  [quantityAdd.fulfilled]: (state, action) => action.payload,\n  [quantityRemove.fulfilled]: (state, action) => action.payload,\n});\n\nexport default cartReducer;\n"]},"metadata":{},"sourceType":"module"}